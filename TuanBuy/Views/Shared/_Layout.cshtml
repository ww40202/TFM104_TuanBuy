@using Microsoft.AspNetCore.Mvc.Infrastructure
@using System.Security.Claims

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Ashion Template">
    <meta name="keywords" content="Ashion, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>TuanBuy</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- Js Plugins -->
    <script src="~/js/jquery-3.3.1.min.js"></script>
    <script src="~/js/bootstrap.min.js"></script>
    <script src="~/js/jquery.magnific-popup.min.js"></script>
    <script src="~/js/jquery-ui.min.js"></script>
    <script src="~/js/mixitup.min.js"></script>
    <script src="~/js/jquery.countdown.min.js"></script>
    <script src="~/js/jquery.slicknav.js"></script>
    <script src="~/js/owl.carousel.min.js"></script>
    <script src="~/js/jquery.nicescroll.min.js"></script>
    <script src="~/js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>


    <!-- JS dropdown -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- 通知 -->
    <link rel="stylesheet" href="https://anijs.github.io/lib/anicollection/anicollection.css" />



    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!--套用vue -->
    <script src="~/js/vue.min.js"></script>

    @*<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>*@
    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Cookie&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <!--加載 Google 平台庫-->
    <script src="https://apis.google.com/js/platform.js" async defer></script>

    <!-- Css Styles -->
    <link rel="stylesheet" href="~/css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="~/css/font-awesome.min.css" type="text/css">
    <link rel="stylesheet" href="~/css/elegant-icons.css" type="text/css">
    <link rel="stylesheet" href="~/css/jquery-ui.min.css" type="text/css">
    <link rel="stylesheet" href="~/css/magnific-popup.css" type="text/css">
    <link rel="stylesheet" href="~/css/owl.carousel.min.css" type="text/css">
    <link rel="stylesheet" href="~/css/slicknav.min.css" type="text/css">
    <link rel="stylesheet" href="~/css/style.css" type="text/css">
    <!-- 本機 -->
    <link rel="stylesheet" href="~/css/mystyle.css">
    <link rel="stylesheet" href="~/css/lynn.css" />

</head>

<body>
    <!-- Page Preloder -->
    <div id="preloder">
        <div class="loader"></div>
    </div>

    <!-- Offcanvas Menu Begin -->
    <div class="offcanvas-menu-overlay"></div>
    <div class="offcanvas-menu-wrapper">
        <div class="offcanvas__close">+</div>
        <div class="offcanvas__logo">
            <a href="./index.html"><img src="~/img/logo.png" alt=""></a>
        </div>
        <div id="mobile-menu-wrap"></div>
        <div class="offcanvas__auth">
            <a href=@Url.Action("Register","Home")>註冊</a>
            <a href=@Url.Action("Login","Home")>登入</a>
        </div>
    </div>
    <!-- Offcanvas Menu End -->
    <!-- Header Section Begin -->
    <header class="header" id="layout">
        <div class="container">
            <div class="row">
                <div class="col-lg-2 texthead1">
                    <a href=@Url.Action("Index","Home")><img src="/img/Log.png" alt=""></a>
                </div>
                <div class="col-lg-7 texthead2">
                    <p class="display headsize1">|</p>
                    <a class="display headsize" href="#" v-on:click="checkUser">開團</a>
                </div>
                @{
                    System.Diagnostics.Debug.Assert(User.Identity != null, "User.Identity != null");
                    if (User.Identity.IsAuthenticated)
                    {
                        <div class="col-lg-3 texthead3">
                            <a class="display" href="#" id="bell">
                                <div class="bell-icon" tabindex="0">
                                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px"
                                         y="0px" width="60px" height="40px" viewBox="0 0 50 30" enable-background="new 0 0 50 30"
                                         xml:space="preserve">
                                    <g class="bell-icon__group">
                                    <path class="bell-icon__ball" id="ball" fill-rule="evenodd" stroke-width="1.5" clip-rule="evenodd"
                                          fill="none" stroke="#currentColor" stroke-miterlimit="10"
                                          d="M28.7,25 c0,1.9-1.7,3.5-3.7,3.5s-3.7-1.6-3.7-3.5s1.7-3.5,3.7-3.5S28.7,23,28.7,25z" />
                                    <path class="bell-icon__shell" id="shell" fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF"
                                          stroke="#currentColor" stroke-width="2" stroke-miterlimit="10"
                                          d="M35.9,21.8c-1.2-0.7-4.1-3-3.4-8.7c0.1-1,0.1-2.1,0-3.1h0c-0.3-4.1-3.9-7.2-8.1-6.9c-3.7,0.3-6.6,3.2-6.9,6.9h0 c-0.1,1-0.1,2.1,0,3.1c0.6,5.7-2.2,8-3.4,8.7c-0.4,0.2-0.6,0.6-0.6,1v1.8c0,0.2,0.2,0.4,0.4,0.4h22.2c0.2,0,0.4-0.2,0.4-0.4v-1.8 C36.5,22.4,36.3,22,35.9,21.8L35.9,21.8z" />
                </g>
              </svg>
                                    <div class="notification-amount">
                                        <span>1</span>
                                    </div>
                                </div>
                            </a>
                            <!-- The example -->
                            <div id="demo-notification" class="notifidiv">
                                <div id="notification">
                                    <div class="toolbar">
                                        <div class="delete">
                                            <i class="fa fa-trash"></i>
                                        </div>
                                        <div class="app-icon load-more">
                                            <i class="fa fa-bell"></i>
                                        </div>
                                    </div>
                                    <div class="notification-container list">
                                        <div class="item note note-gray fadeIn animated">
                                            <div class="item-image note-icon">
                                                <i class="fa fa-coffee"></i>
                                            </div>
                                            <div class="item-body note-text">
                                                Lorem ipsum dolor
                                            </div>
                                            <a href="#" class="note-close">
                                                <i class="fa fa-close"></i>
                                            </a>
                                        </div><div class="item note note-gray fadeIn animated">
                                            <div class="item-image note-icon">
                                                <i class="fa fa-coffee"></i>
                                            </div>
                                            <div class="item-body note-text">
                                                Lorem ipsum dolor
                                            </div>
                                            <a href="#" class="note-close">
                                                <i class="fa fa-close"></i>
                                            </a>
                                        </div>
                                        <div class="item note note-gray fadeIn animated">
                                            <div class="item-image note-icon">
                                                <i class="fa fa-coffee"></i>
                                            </div>
                                            <div class="item-body note-text">
                                                Lorem ipsum dolor
                                            </div>
                                            <a href="#" class="note-close">
                                                <i class="fa fa-close"></i>
                                            </a>
                                        </div>
                                        <div class="item note note-gray fadeIn animated">
                                            <div class="item-image note-icon">
                                                <i class="fa fa-coffee"></i>
                                            </div>
                                            <div class="item-body note-text">
                                                Lorem ipsum dolor
                                            </div>
                                            <a href="#" class="note-close">
                                                <i class="fa fa-close"></i>
                                            </a>
                                        </div>
                                        <div class="item note note-gray fadeIn animated">
                                            <div class="item-image note-icon">
                                                <i class="fa fa-coffee"></i>
                                            </div>
                                            <div class="item-body note-text">
                                                Lorem ipsum dolor
                                            </div>
                                            <a href="#" class="note-close">
                                                <i class="fa fa-close"></i>
                                            </a>
                                        </div>
                                        <div class="item note note-gray fadeIn animated">
                                            <div class="item-image note-icon">
                                                <i class="fa fa-coffee"></i>
                                            </div>
                                            <div class="item-body note-text">
                                                Lorem ipsum dolor
                                            </div>
                                            <a href="#" class="note-close">
                                                <i class="fa fa-close"></i>
                                            </a>
                                        </div>
                                    </div>
                                    <div class="read-more load-more">
                                        <i class="fa fa-bell"></i>
                                        Read More
                                    </div>
                                </div>
                            </div>
                            <!-- End example -->
                            <div class="dropdown display  dropnamefix">
                                <button class="btn" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-expanded="false">
                                        <img v-bind:src="picPath.picPath" alt="Avatar" width="50" height="50" class="Largeheadsticker">
                                    <p class="headnamesize display">{{user}}</p>
                                </button>
                                <div class="dropdown-menu dropmenufix" aria-labelledby="dropdownMenuButton">
                                    <div><a href=@Url.Action("Index","MemberCenter")><i class="fa fa-user-o dorpiconcentermg"></i>會員中心</a></div>
                                    @if (User.IsInRole("SystemAdmin"))
                                    {
                                      <div><a href=@Url.Action("Index","TestBackMange")><i class="fa fa-user-o dorpiconcentermg"></i>後臺管理</a></div>
                                    }
                                    <div><a href=@Url.Action("ChatRoom","Member")><i class="fa fa-comment-o dorpiconmessagemg" aria-hidden="true"></i>聊天室</a></div>
                                    <div><a href=@Url.Action("ReadyProduct","Product")><i class="fa fa-bookmark-o dorpiconaddmg" aria-hidden="true"></i>收藏</a></div>
                                    <div><a href="#" v-on:click="logout"><i class="fa fa-sign-out dorpiconlogoutmg" aria-hidden="true"></i>登出</a></div>
                                </div>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="col-lg-3 texthead4">
                            <a class="display headsize3" href=@Url.Action("Register","Home")>註冊</a>
                            <a class="display headsize" href=@Url.Action("Login","Home")>登入</a>
                        </div>
                    }
                }

            </div>
        </div>
    </header>
    <!-- Header Section End -->
    @RenderBody();

    <!-- Footer Section Begin -->
    <footer class="ftborder">
        <div class="container">
            <div class="row">
                <div class="col-lg-3 textft1">
                    <a href="#"><img src="/img/Log.png" alt="logo"></a>
                </div>
                <div class="col-lg-6 textft2">
                    <a class="display headsize3" href="#">關於</a>
                    <a class="display headsize3" href="#">聯絡我們</a>
                </div>
                <div class="col-lg-3 footer__social textft3">
                    <a href="#"><i class="fa fa-facebook"></i></a>
                    <a href="#"><i class="fa fa-twitter"></i></a>
                    <a href="#"><i class="fa fa-instagram"></i></a>
                </div>
            </div>
        </div>
    </footer>
    <!-- Footer Section End -->

</body>
</html>

<script>
    var fullShow = "@User.IsInRole("FullUser")";
    var nomalShow = "@User.IsInRole("User")";
    var layout = new Vue({
        el: '#layout',
        data: {
            user: "",
            picPath: ""
        },
        mounted: function() {
            let self = this;
            axios.get("/api/LoginAndRegister/")
                .then((resp) => {
                    self.user = resp.data; })
                .catch((res)=>res.response.data);
            axios.get("/api/MemberCenter/")
                .then((resp) => { self.picPath = resp.data })
                .catch((res)=>res.response.data);
        },
        methods: {
            logout: function() {
                axios.delete("/api/LoginAndRegister").then(() => {
                    window.location.href = "/Home/Index";
                });
            },
            checkUser:function() {
                if (nomalShow === "True") {
                    Swal.fire({
                        icon: 'error',
                        title: '沒有權限',
                        text: '請把會員資料填寫完整！'
                    });
                    return;
                }
                if (fullShow==="False") {
                    Swal.fire({
                        icon: 'error',
                        title: '請先登入',
                        text: '請登入會員！'
                    });
                    return;
                }
                else {
                    window.location.href = "/Product/Index";
                }
            }
        }

    });


</script>

@*通知*@
<script>
    $(document).ready(function () {
        $("#bell").click(function () {
            $("#demo-notification").toggle();
        });
    });</script>